window.addEventListener("DOMContentLoaded", (e) => {
	document.body.addEventListener("click", vote);
});

async function vote(e) {
	const clicked = e.target.id; // all vote buttons need an id of the format upVoteFor420 or downVoteFor2020 generated by the templet
	console.log("This worked");

	if (!clicked.includes("VoteFor")) return;
	console.log("This worked, too");
	e.preventDefault();
	let [isUpVote, questionId] = clicked.split("For");
	isUpVote = isUpVote === "upVote";
	const res = await fetch(
		`http://localhost:8080/questions/${questionId}/vote`,
		{
			method: "POST",
			headers: {
				"Content-Type": "application/json",
			},
			body: JSON.stringify({ isUpVote }),
		},
	).catch((e) => console.log(e));
	if (res.redirected) return (window.location = res.url);
	const { count } = await res.json();
	document.querySelector(`#voteCountFor${questionId}`).innerHTML = count;
}
